!function(){angular.module("app",["app.core","app.streamers"])}(),function(){angular.module("app.core",["ngCookies"])}(),function(){angular.module("app.streamers",[])}(),function(){function e(e,n,t,a){function r(e){return n(function(n,t){var a=v.slice(0);if(e&&(e.state&&(a=a.filter(function(n){return n.online===("online"===e.state)})),e.name)){var r=new RegExp(e.name,"i");a=a.filter(function(e){return r.test(e.name)||r.test(e.displayName)})}n(a)})}function i(){return n(function(e,t){var a=[];v.forEach(function(e){a.push(c(e.name))}),e(n.all(a))})}function o(e){return n(function(n,t){if(e)if(e.name){var a=v.map(function(e){return e.name}).indexOf(e.name);if(-1!==a){var r=v.splice(a,1)[0];v.splice(e.newIndex,0,r)}}else if("name"===e.split(":")[0])switch(e.split(":")[1]){case"asc":v.sort(function(e,n){return e=e.displayName.toLowerCase(),n=n.displayName.toLowerCase(),n>e?-1:e>n?1:0});break;case"desc":v.sort(function(e,n){return e=e.displayName.toLowerCase(),n=n.displayName.toLowerCase(),n>e?1:e>n?-1:0})}else if("online"===e.split(":")[0])switch(e.split(":")[1]){case"true":v.sort(function(e,n){return e.online===n.online?0:e.online?-1:1});break;case"false":v.sort(function(e,n){return e.online===n.online?0:e.online?1:-1})}n("Streamers sorted.")})}function c(e){return l(e).then(d)["catch"](function(n){a.warn("Failed to add streamer: "+e+".",n)})}function s(e){return h(e)["catch"](function(n){a.warn("Failed to remove streamer: "+e+".",n)})}function u(t){function r(e){return n(function(n,t){var a=[],r=5;if(e=e.data.channels)for(var i=0;r>i&&e[i];i++){var o={};o.name=e[i].name,o.displayName=e[i].display_name,a.push(o)}n(a)})}return e.jsonp("https://api.twitch.tv/kraken/search/channels?q="+t+"&callback=JSON_CALLBACK").then(r)["catch"](function(e){a.warn("Failed to get streamer IDs.",e)})}function f(){var e=p||m();return e}function m(){function r(){return n(function(n,a){var r=t.get("trackedStreamers"),i=[];r?(r.split(",").forEach(function(e){i.push(c(e))}),n(i)):e.jsonp("https://api.twitch.tv/kraken/streams/?callback=JSON_CALLBACK").then(function(e){var t=[e.data.streams[0].channel.name,e.data.streams[1].channel.name,e.data.streams[2].channel.name,e.data.streams[3].channel.name,e.data.streams[4].channel.name];t.forEach(function(e){i.push(c(e))}),n(i)})["catch"](function(e){a(e)})})}return p?p:r().then(function(e){return n.all(e)}).then(function(){return p=n.when(!0)})["catch"](function(e){a.warn("Failed to initialize data service.",e)})}function l(t){function r(){return n(function(n,a){var r={};e.jsonp("https://api.twitch.tv/kraken/streams/"+t+"?callback=JSON_CALLBACK").then(function(n){return r.basic=n,e.jsonp(n.data._links.channel+"?callback=JSON_CALLBACK")}).then(function(n){return r.channel=n,e.jsonp(n.data._links.videos+"?callback=JSON_CALLBACK")}).then(function(e){r.videos=e,n(r)})["catch"](function(e){a(e)})})}function i(e){return n(function(n,a){var r={};if(e){var i=e.basic,o=e.channel,c=e.videos;r.name=t,r.online=null!==i.data.stream,r.online&&(r.stream={},r.stream.game=i.data.stream.game,r.stream.viewers=i.data.stream.viewers,r.stream.preview=i.data.stream.preview.large),r.displayName=o.data.display_name,r.logo=o.data.logo,r.status=o.data.status,r.url=o.data.url,r.videoBanner=o.data.video_banner,r.videos=[],c.data.videos.forEach(function(e){r.videos.push({title:e.title,description:e.description,date:e.recorded_at,duration:e.length,preview:e.preview,url:e.url})})}n(r)})}return r().then(i)["catch"](function(e){a.warn("Failed to get streamer: "+t+".",e)})}function d(e){function r(){return n(function(n,t){if(e&&e.name){var a=v.map(function(e){return e.name}).indexOf(e.name);-1!==a?v[a]=e:v.unshift(e),n("Streamer data cached.")}else t("Attempting to cache data on an unknown streamer.")})}function i(){return n(function(n,a){if(e&&e.name){var r=t.get("trackedStreamers");if(r){var i=-1!==r.split(",").indexOf(e.name);i||(r=e.name+","+r,t.put("trackedStreamers",r))}else t.put("trackedStreamers",e.name);n("Streamer remembered.")}else a("Attempting to remember an unknown streamer.")})}return r().then(i)["catch"](function(e){a.warn("Failed to track a streamer.",e)})}function h(e){function r(){return n(function(n,t){e?(e.name&&(e=e.name),v=v.filter(function(n){return n.name!==e}),n("Streamer data uncached.")):t("Attempting to uncache data on an unknown streamer.")})}function i(){return n(function(n,a){if(e){var r=t.get("trackedStreamers");r&&(r=r.split(",").filter(function(n){return n!==e}).join(","),t.put("trackedStreamers",r)),n("Streamer forgotten.")}else a("Attempting to forget an unknown streamer.")})}return r().then(i)["catch"](function(e){a.warn("Failed to untrack a streamer.",e)})}var p,v=[],g={getStreamers:r,refreshStreamers:i,sortStreamers:o,addStreamer:c,removeStreamer:s,getStreamerIDs:u,ready:f};return g}angular.module("app.core").factory("dataservice",["$http","$q","$cookies","$log",e])}(),function(){function e(e){function n(){e.refreshStreamers().then(s)}function t(n){e.sortStreamers(n).then(s)}function a(){s()}function r(){e.addStreamer(u.toAdd).then(s),u.toAdd=""}function i(n){e.removeStreamer(n).then(s)}function o(){e.getStreamerIDs(u.toAdd).then(function(e){u.foundIDs=e})["catch"](function(e){})}function c(){e.ready().then(s)}function s(){e.getStreamers(u.filterOptions).then(function(e){u.streamers=e})["catch"](function(e){})}var u=this;u.streamers=[],u.foundIDs=[],u.refresh=n,u.sort=t,u.filter=a,u.filterOptions={},u.add=r,u.toAdd="",u.remove=i,u.findMatchingIDs=o,c()}angular.module("app.streamers").controller("StreamersController",["dataservice",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb3JlL2NvcmUubW9kdWxlLmpzIiwic3RyZWFtZXJzL3N0cmVhbWVycy5tb2R1bGUuanMiLCJjb3JlL2RhdGFzZXJ2aWNlLmpzIiwic3RyZWFtZXJzL3N0cmVhbWVycy5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJkYXRhc2VydmljZSIsIiRodHRwIiwiJHEiLCIkY29va2llcyIsIiRsb2ciLCJnZXRTdHJlYW1lcnMiLCJmaWx0ZXJPcHRpb25zIiwicmVzb2x2ZSIsInJlamVjdCIsImNvcHkiLCJzdHJlYW1lcnMiLCJzbGljZSIsInN0YXRlIiwiZmlsdGVyIiwic3RyZWFtZXIiLCJvbmxpbmUiLCJuYW1lIiwicmUiLCJSZWdFeHAiLCJ0ZXN0IiwiZGlzcGxheU5hbWUiLCJyZWZyZXNoU3RyZWFtZXJzIiwicHJvbWlzZXMiLCJmb3JFYWNoIiwicHVzaCIsImFkZFN0cmVhbWVyIiwiYWxsIiwic29ydFN0cmVhbWVycyIsInNvcnRPcHRpb24iLCJpIiwibWFwIiwiaW5kZXhPZiIsInJlbW92ZWQiLCJzcGxpY2UiLCJuZXdJbmRleCIsInNwbGl0Iiwic29ydCIsImEiLCJiIiwidG9Mb3dlckNhc2UiLCJnZXRTdHJlYW1lciIsInRoZW4iLCJ0cmFja1N0cmVhbWVyIiwiZXJyIiwid2FybiIsInJlbW92ZVN0cmVhbWVyIiwidW50cmFja1N0cmVhbWVyIiwiZ2V0U3RyZWFtZXJJRHMiLCJzZWFyY2hQYXR0ZXJuIiwiZm9ybWF0UmVzdWx0cyIsInJlc3VsdHMiLCJzdHJlYW1lcklEcyIsIm1heElEcyIsImRhdGEiLCJjaGFubmVscyIsInN0cmVhbWVySUQiLCJkaXNwbGF5X25hbWUiLCJqc29ucCIsInJlYWR5IiwicHJvbWlzZSIsInJlYWR5UHJvbWlzZSIsImluaXRpYWxpemUiLCJwcm9taXNlc1RvQ29tcGxldGUiLCJ0cmFja2VkIiwiZ2V0IiwicmVzIiwidG9wU3RyZWFtZXJzIiwic3RyZWFtcyIsImNoYW5uZWwiLCJ3aGVuIiwiZ2V0U3RyZWFtZXJEYXRhIiwiYmFzaWMiLCJfbGlua3MiLCJ2aWRlb3MiLCJmb3JtYXRTdHJlYW1lckRhdGEiLCJiYXNpY0RhdGEiLCJjaGFubmVsRGF0YSIsInZpZGVvc0RhdGEiLCJzdHJlYW0iLCJnYW1lIiwidmlld2VycyIsInByZXZpZXciLCJsYXJnZSIsImxvZ28iLCJzdGF0dXMiLCJ1cmwiLCJ2aWRlb0Jhbm5lciIsInZpZGVvX2Jhbm5lciIsInZpZGVvIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImRhdGUiLCJyZWNvcmRlZF9hdCIsImR1cmF0aW9uIiwibGVuZ3RoIiwiY2FjaGUiLCJleGlzdGluZ1N0cmVhbWVyIiwidW5zaGlmdCIsInJlbWVtYmVyIiwiZXhpc3RzIiwicHV0IiwidW5jYWNoZSIsImZvcmdldCIsImV4aXN0aW5nTmFtZSIsImpvaW4iLCJzZXJ2aWNlIiwiZmFjdG9yeSIsIlN0cmVhbWVyc0NvbnRyb2xsZXIiLCJyZWZyZXNoIiwidXBkYXRlU3RyZWFtZXJzIiwiYWRkIiwidm0iLCJ0b0FkZCIsInJlbW92ZSIsImZpbmRNYXRjaGluZ0lEcyIsIklEcyIsImZvdW5kSURzIiwiYWN0aXZhdGUiLCJ0aGlzIiwiY29udHJvbGxlciJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQUEsUUFBQUMsT0FBQSxPQUVBLFdBRUEscUJDTEEsV0FDQUQsUUFBQUMsT0FBQSxZQUVBLGlCQ0hBLFdBQ0FELFFBQUFDLE9BQUEsdUJDR0EsV0FLQSxRQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQW9CQSxRQUFBQyxHQUFBQyxHQUNBLE1BQUFKLEdBQUEsU0FBQUssRUFBQUMsR0FFQSxHQUFBQyxHQUFBQyxFQUFBQyxNQUFBLEVBR0EsSUFBQUwsSUFDQUEsRUFBQU0sUUFFQUgsRUFBQUEsRUFBQUksT0FBQSxTQUFBQyxHQUNBLE1BQUFBLEdBQUFDLFVBQUEsV0FBQVQsRUFBQU0sVUFJQU4sRUFBQVUsTUFBQSxDQUVBLEdBQUFDLEdBQUEsR0FBQUMsUUFBQVosRUFB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QWxHLE9BQUFBLEVBQ0FrRyxFQUFBekcsaUJBQ0F5RyxFQUFBRCxJQUFBQSxFQUNBQyxFQUFBQyxNQUFBLEdBQ0FELEVBQUFFLE9BQUFBLEVBQ0FGLEVBQUFHLGdCQUFBQSxFQUVBRyxJQWpCQXZILFFBQ0FDLE9BQUEsaUJBQ0F3SCxXQUFBLHVCQUFBLGNBQUFaIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcclxuICAgICAgLyogU2hhcmVkIGJ5IGFsbCBmZWF0dXJlIGFyZWFzLiAqL1xyXG4gICAgICAnYXBwLmNvcmUnLFxyXG4gICAgICAvKiBGZWF0dXJlIGFyZWFzLiAqL1xyXG4gICAgICAnYXBwLnN0cmVhbWVycydcclxuICAgIF0pO1xyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJywgW1xyXG4gICAgLyogQW5ndWxhciBtb2R1bGVzLiAqL1xyXG4gICAgJ25nQ29va2llcycsXHJcbiAgICAvKiBNeSByZXVzYWJsZSBtb2R1bGVzLiAqL1xyXG4gICAgLyogVGhpcmQgcGFydHkgbW9kdWxlcy4gKi9cclxuICBdKTtcclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAuc3RyZWFtZXJzJywgW10pO1xyXG59KSgpO1xyXG4iLCIvKiAgZGF0YXNlcnZpY2UuanNcclxuICogICAgSGFuZGxlcyBhbGwgZGF0YSBvcGVyYXRpb25zLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAuY29yZScpXHJcbiAgICAuZmFjdG9yeSgnZGF0YXNlcnZpY2UnLCBbJyRodHRwJywgJyRxJywgJyRjb29raWVzJywgJyRsb2cnLCBkYXRhc2VydmljZV0pO1xyXG5cclxuICBmdW5jdGlvbiBkYXRhc2VydmljZSgkaHR0cCwgJHEsICRjb29raWVzLCAkbG9nKSB7XHJcbiAgICB2YXIgc3RyZWFtZXJzID0gW107ICAgLy8gQWxsIHRyYWNrZWQgc3RyZWFtZXIgZGF0YS5cclxuICAgIHZhciByZWFkeVByb21pc2U7ICAgICAvLyBSZXNvbHZlZCB3aGVuIHRoZSBkYXRhc2VydmljZSBpcyBmaW5pc2hlZCBpbml0aWFsaXppbmcuXHJcblxyXG4gICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgIGdldFN0cmVhbWVyczogZ2V0U3RyZWFtZXJzLCAgICAgICAgIC8vIEdldCBhIGZpbHRlcmVkIHNoYWxsb3cgY29weSBvZiB0aGUgc3RyZWFtZXJzIGFycmF5LlxyXG4gICAgICByZWZyZXNoU3RyZWFtZXJzOiByZWZyZXNoU3RyZWFtZXJzLCAvLyBSZWZyZXNoIHRoZSBzdHJlYW1lciBkYXRhIGluIHRoZSBzdHJlYW1lcnMgYXJyYXkuXHJcbiAgICAgIHNvcnRTdHJlYW1lcnM6IHNvcnRTdHJlYW1lcnMsICAgICAgIC8vIFNvcnQgdGhlIHN0cmVhbWVycyBhcnJheS5cclxuICAgICAgYWRkU3RyZWFtZXI6IGFkZFN0cmVhbWVyLCAgICAgICAgICAgLy8gQWRkIGEgc3RyZWFtZXIgdG8gdGhlIHN0cmVhbWVycyBhcnJheSBhbmQgY29va2llLlxyXG4gICAgICByZW1vdmVTdHJlYW1lcjogcmVtb3ZlU3RyZWFtZXIsICAgICAvLyBSZW1vdmUgYSBzdHJlYW1lciBmcm9tIHRoZSBzdHJlYW1lcnMgYXJyYXkgYW5kIGNvb2tpZS5cclxuICAgICAgZ2V0U3RyZWFtZXJJRHM6IGdldFN0cmVhbWVySURzLCAgICAgLy8gR2V0IGFuIGFycmF5IG9mIHN0cmVhbWVySURzIHRoYXQgbWF0Y2ggYSBzZWFyY2ggcGF0dGVybi5cclxuICAgICAgcmVhZHk6IHJlYWR5ICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3VhcmFudGVlIHRoZSBkYXRhIHNlcnZpY2UgaGFzIGJlZW4gaW5pdGlhbGl6ZWQuXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgIC8qICBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgZmlsdGVyZWQgc2hhbGxvdyBjb3B5IG9mIHRoZSBzdHJlYW1lcnMgYXJyYXkuXHJcbiAgICAgKiAgICBmaWx0ZXJPcHRpb25zOiB7bmFtZTogU3RyaW5nLCBzdGF0ZTogU3RyaW5nfVxyXG4gICAgICogICAgSWYgZGVmaW5lZCwgZmlsdGVyT3B0aW9ucy5zdGF0ZSBtYXkgYmUgJ29ubGluZScgb3IgJ29mZmxpbmUnLlxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBnZXRTdHJlYW1lcnMoZmlsdGVyT3B0aW9ucykge1xyXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIGEgc2hhbGxvdyBjb3B5IG9mIHRoZSBzdHJlYW1lcnMgYXJyYXkuXHJcbiAgICAgICAgdmFyIGNvcHkgPSBzdHJlYW1lcnMuc2xpY2UoMCk7XHJcblxyXG4gICAgICAgIC8vIEZpbHRlciB0aGUgY29weS5cclxuICAgICAgICBpZiAoZmlsdGVyT3B0aW9ucykge1xyXG4gICAgICAgICAgaWYgKGZpbHRlck9wdGlvbnMuc3RhdGUpIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgc3RyZWFtZXIncyBvbmxpbmUgc3RhdGUgbWF0Y2hlcyB0aGUgZmlsdGVyIHN0YXRlLlxyXG4gICAgICAgICAgICBjb3B5ID0gY29weS5maWx0ZXIoZnVuY3Rpb24oc3RyZWFtZXIpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKHN0cmVhbWVyLm9ubGluZSA9PT0gKGZpbHRlck9wdGlvbnMuc3RhdGUgPT09ICdvbmxpbmUnKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmIChmaWx0ZXJPcHRpb25zLm5hbWUpIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGEgbG9vc2UgbWF0Y2ggd2l0aCBlaXRoZXIgdGhlIHN0cmVhbWVyJ3MgbmFtZSBvciBkaXNwbGF5IG5hbWUuXHJcbiAgICAgICAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAoZmlsdGVyT3B0aW9ucy5uYW1lLCAnaScpO1xyXG4gICAgICAgICAgICBjb3B5ID0gY29weS5maWx0ZXIoZnVuY3Rpb24oc3RyZWFtZXIpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKHJlLnRlc3Qoc3RyZWFtZXIubmFtZSkgfHwgcmUudGVzdChzdHJlYW1lci5kaXNwbGF5TmFtZSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJlc29sdmUgd2l0aCB0aGUgY29weS5cclxuICAgICAgICByZXNvbHZlKGNvcHkpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHN0cmVhbWVycyBhcnJheSBpcyB1cGRhdGVkIHdpdGggdGhlIGxhdGVzdCBkYXRhLiAqL1xyXG4gICAgZnVuY3Rpb24gcmVmcmVzaFN0cmVhbWVycygpIHtcclxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xyXG5cclxuICAgICAgICBzdHJlYW1lcnMuZm9yRWFjaChmdW5jdGlvbihzdHJlYW1lcikge1xyXG4gICAgICAgICAgcHJvbWlzZXMucHVzaChhZGRTdHJlYW1lcihzdHJlYW1lci5uYW1lKSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlc29sdmUoJHEuYWxsKHByb21pc2VzKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qICBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHN0cmVhbWVycyBhcnJheSdzIGVsZW1lbnRzIGFyZSBzb3J0ZWQuXHJcbiAgICAgKiAgICBQb3NzaWJsZSBzb3J0IG9wdGlvbnM6XHJcbiAgICAgKiAgICAgICduYW1lOmFzYycsICduYW1lOmRlc2MnXHJcbiAgICAgKiAgICAgICdvbmxpbmU6dHJ1ZScsICdvbmxpbmU6ZmFsc2UnXHJcbiAgICAgKiAgICAgIHtuYW1lOiAnYm9iJywgbmV3SW5kZXg6IDN9XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHNvcnRTdHJlYW1lcnMoc29ydE9wdGlvbikge1xyXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgaWYgKHNvcnRPcHRpb24pIHtcclxuICAgICAgICAgIGlmIChzb3J0T3B0aW9uLm5hbWUpIHtcclxuICAgICAgICAgICAgLy8gTW92ZSB0aGUgbmFtZWQgc3RyZWFtZXIgdG8gdGhlIG5ldyBpbmRleC5cclxuXHJcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIG5hbWVkIHN0cmVhbWVyJ3MgaW5kZXggcG9zaXRpb24gaW4gc3RyZWFtZXJzIGFycmF5LlxyXG4gICAgICAgICAgICB2YXIgaSA9IHN0cmVhbWVycy5tYXAoZnVuY3Rpb24oc3RyZWFtZXIpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtZXIubmFtZTtcclxuICAgICAgICAgICAgfSkuaW5kZXhPZihzb3J0T3B0aW9uLm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgLy8gSWYgdGhlIG5hbWVkIHN0cmVhbWVyIGV4aXN0cy4uLlxyXG4gICAgICAgICAgICBpZiAoaSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIG5hbWVkIHN0cmVhbWVyIGZyb20gdGhlIHN0cmVhbWVycyBhcnJheS5cclxuICAgICAgICAgICAgICB2YXIgcmVtb3ZlZCA9IHN0cmVhbWVycy5zcGxpY2UoaSwgMSlbMF07XHJcblxyXG4gICAgICAgICAgICAgIC8vIEFkZCB0aGUgbmFtZWQgc3RyZWFtZXIgYmFjayBpbnRvIHRoZSBzdHJlYW1lcnMgYXJyYXkgYXQgdGhlIGRlc2lyZWQgcG9zaXRpb24uXHJcbiAgICAgICAgICAgICAgc3RyZWFtZXJzLnNwbGljZShzb3J0T3B0aW9uLm5ld0luZGV4LCAwLCByZW1vdmVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIGlmIChzb3J0T3B0aW9uLnNwbGl0KCc6JylbMF0gPT09ICduYW1lJykge1xyXG4gICAgICAgICAgICAvLyBTb3J0IGFscGhhYmV0aWNhbGx5LlxyXG4gICAgICAgICAgICBzd2l0Y2ggKHNvcnRPcHRpb24uc3BsaXQoJzonKVsxXSkge1xyXG4gICAgICAgICAgICAgIGNhc2UgJ2FzYyc6XHJcbiAgICAgICAgICAgICAgICAvLyBTb3J0IGFscGhhYmV0aWNhbGx5IGFzY2VuZGluZyAoQS1aKS5cclxuICAgICAgICAgICAgICAgIHN0cmVhbWVycy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgYSA9IGEuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgYiA9IGIuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGlmIChhIDwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhID4gYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ2Rlc2MnOlxyXG4gICAgICAgICAgICAgICAgLy8gU29ydCBhbHBoYWJldGljYWxseSBkZXNjZW5kaW5nIChaLUEpLlxyXG4gICAgICAgICAgICAgICAgc3RyZWFtZXJzLnNvcnQoZnVuY3Rpb24oYSxiKSB7XHJcbiAgICAgICAgICAgICAgICAgIGEgPSBhLmRpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgIGIgPSBiLmRpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICBpZiAoYSA8IGIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhID4gYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSBpZiAoc29ydE9wdGlvbi5zcGxpdCgnOicpWzBdID09PSAnb25saW5lJykge1xyXG4gICAgICAgICAgICAvLyBTb3J0IGJ5IG9ubGluZSBzdGF0ZS5cclxuICAgICAgICAgICAgc3dpdGNoIChzb3J0T3B0aW9uLnNwbGl0KCc6JylbMV0pIHtcclxuICAgICAgICAgICAgICBjYXNlICd0cnVlJzpcclxuICAgICAgICAgICAgICAgIC8vIFNvcnQgb25saW5lIGZpcnN0IChvbmxpbmUtb2ZmbGluZSkuXHJcbiAgICAgICAgICAgICAgICBzdHJlYW1lcnMuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChhLm9ubGluZSA9PT0gYi5vbmxpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBCb3RoIGFyZSBlaXRoZXIgb25saW5lIG9yIG9mZmxpbmUuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5vbmxpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhIGlzIG9ubGluZSwgd2hpY2ggbWVhbnMgYiBtdXN0IGJlIG9mZmxpbmUuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGEgaXMgb2ZmbGluZSwgd2hpY2ggbWVhbnMgYiBtdXN0IGJlIG9ubGluZS5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdmYWxzZSc6XHJcbiAgICAgICAgICAgICAgICAvLyBTb3J0IG9mZmxpbmUgZmlyc3QgKG9mZmxpbmUtb25saW5lKS5cclxuICAgICAgICAgICAgICAgIHN0cmVhbWVycy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKGEub25saW5lID09PSBiLm9ubGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEJvdGggYXJlIGVpdGhlciBvbmxpbmUgb3Igb2ZmbGluZS5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLm9ubGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGEgaXMgb25saW5lLCB3aGljaCBtZWFucyBiIG11c3QgYmUgb2ZmbGluZS5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhIGlzIG9mZmxpbmUsIHdoaWNoIG1lYW5zIGIgbXVzdCBiZSBvbmxpbmUuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXNvbHZlKCdTdHJlYW1lcnMgc29ydGVkLicpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHN0cmVhbWVyIGhhcyBiZWVuIGFkZGVkLiAqL1xyXG4gICAgZnVuY3Rpb24gYWRkU3RyZWFtZXIobmFtZSkge1xyXG4gICAgICByZXR1cm4gZ2V0U3RyZWFtZXIobmFtZSlcclxuICAgICAgICAudGhlbih0cmFja1N0cmVhbWVyKVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICRsb2cud2FybignRmFpbGVkIHRvIGFkZCBzdHJlYW1lcjogJyArIG5hbWUgKyAnLicsIGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyogUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBzdHJlYW1lciBoYXMgYmVlbiByZW1vdmVkLiAqL1xyXG4gICAgZnVuY3Rpb24gcmVtb3ZlU3RyZWFtZXIobmFtZSkge1xyXG4gICAgICByZXR1cm4gdW50cmFja1N0cmVhbWVyKG5hbWUpXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgJGxvZy53YXJuKCdGYWlsZWQgdG8gcmVtb3ZlIHN0cmVhbWVyOiAnICsgbmFtZSArICcuJywgZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGFuIGFycmF5IG9mIHN0cmVhbWVySURzICh7bmFtZTogU3RyaW5nLCBkaXNwbGF5TmFtZTogU3RyaW5nfSkgdGhhdCBtYXRjaCB0aGUgc2VhcmNoUGF0dGVybi4gKi9cclxuICAgIGZ1bmN0aW9uIGdldFN0cmVhbWVySURzKHNlYXJjaFBhdHRlcm4pIHtcclxuICAgICAgcmV0dXJuICRodHRwLmpzb25wKCdodHRwczovL2FwaS50d2l0Y2gudHYva3Jha2VuL3NlYXJjaC9jaGFubmVscz9xPScgKyBzZWFyY2hQYXR0ZXJuICsgJyZjYWxsYmFjaz1KU09OX0NBTExCQUNLJylcclxuICAgICAgICAudGhlbihmb3JtYXRSZXN1bHRzKVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICRsb2cud2FybignRmFpbGVkIHRvIGdldCBzdHJlYW1lciBJRHMuJywgZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIGZvcm1hdFJlc3VsdHMocmVzdWx0cykge1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIHZhciBzdHJlYW1lcklEcyA9IFtdO1xyXG4gICAgICAgICAgdmFyIG1heElEcyA9IDU7XHJcblxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZGF0YS5jaGFubmVscztcclxuXHJcbiAgICAgICAgICBpZiAocmVzdWx0cykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1heElEczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGxlc3MgdGhhbiBpIHJlc3VsdHMsIHdlJ3JlIGRvbmUuXHJcbiAgICAgICAgICAgICAgaWYgKCFyZXN1bHRzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIHZhciBzdHJlYW1lcklEID0ge307XHJcbiAgICAgICAgICAgICAgc3RyZWFtZXJJRC5uYW1lID0gcmVzdWx0c1tpXS5uYW1lO1xyXG4gICAgICAgICAgICAgIHN0cmVhbWVySUQuZGlzcGxheU5hbWUgPSByZXN1bHRzW2ldLmRpc3BsYXlfbmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgc3RyZWFtZXJJRHMucHVzaChzdHJlYW1lcklEKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJlc29sdmUoc3RyZWFtZXJJRHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyogUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyBlaXRoZXIgaW1tZWRpYXRlbHkgb3IgYWZ0ZXIgdGhlIGRhdGEgc2VydmljZSBmaW5pc2hlcyBpbml0aWFsaXppbmcuICovXHJcbiAgICBmdW5jdGlvbiByZWFkeSgpIHtcclxuICAgICAgdmFyIHByb21pc2UgPSByZWFkeVByb21pc2UgfHwgaW5pdGlhbGl6ZSgpO1xyXG4gICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBTZXRzIHRoZSByZWFkeVByb21pc2UgYWZ0ZXIgY29tcGxldGluZyBuZWNlc3NhcnkgaW5pdGlhbGl6YXRpb24gb3BlcmF0aW9ucy4gKi9cclxuICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgICAgIC8vIEVuc3VyZSB0aGF0IHRoaXMgaXMgb25seSBjYWxsZWQgb25jZS5cclxuICAgICAgaWYgKHJlYWR5UHJvbWlzZSkge1xyXG4gICAgICAgIHJldHVybiByZWFkeVByb21pc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCB0aGUgcHJvbWlzZXMgbmVlZGVkIHRvIGNvbXBsZXRlIGluaXRpYWxpemF0aW9uLlxyXG4gICAgICByZXR1cm4gcHJvbWlzZXNUb0NvbXBsZXRlKClcclxuICAgICAgICAvLyBXYWl0IGZvciB0aG9zZSBwcm9taXNlcyB0byBmaW5pc2guXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocHJvbWlzZXMpIHtcclxuICAgICAgICAgIHJldHVybiAkcS5hbGwocHJvbWlzZXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLy8gUmV0dXJuIHRoZSByZWFkeSBwcm9taXNlLlxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgcmVhZHlQcm9taXNlID0gJHEud2hlbih0cnVlKTtcclxuICAgICAgICAgIHJldHVybiByZWFkeVByb21pc2U7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAkbG9nLndhcm4oJ0ZhaWxlZCB0byBpbml0aWFsaXplIGRhdGEgc2VydmljZS4nLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgZnVuY3Rpb24gcHJvbWlzZXNUb0NvbXBsZXRlKCkge1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIHZhciB0cmFja2VkID0gJGNvb2tpZXMuZ2V0KCd0cmFja2VkU3RyZWFtZXJzJyk7XHJcbiAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICBpZiAoIXRyYWNrZWQpIHtcclxuICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gcmVjb3JkIG9mIHRyYWNrZWQgc3RyZWFtZXJzIGZvciB0aGlzIHVzZXIuIChFaXRoZXIgbm8gY29va2llLCBvciBhbiBlbXB0eSBjb29raWUuKVxyXG4gICAgICAgICAgICAvLyBVc2Ugc29tZSBvZiB0aGUgY3VycmVudCBtb3N0IHBvcHVsYXIgc3RyZWFtZXJzLlxyXG4gICAgICAgICAgICAkaHR0cC5qc29ucCgnaHR0cHM6Ly9hcGkudHdpdGNoLnR2L2tyYWtlbi9zdHJlYW1zLycgKyAnP2NhbGxiYWNrPUpTT05fQ0FMTEJBQ0snKVxyXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvcFN0cmVhbWVycyA9IFtcclxuICAgICAgICAgICAgICAgICAgcmVzLmRhdGEuc3RyZWFtc1swXS5jaGFubmVsLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIHJlcy5kYXRhLnN0cmVhbXNbMV0uY2hhbm5lbC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICByZXMuZGF0YS5zdHJlYW1zWzJdLmNoYW5uZWwubmFtZSxcclxuICAgICAgICAgICAgICAgICAgcmVzLmRhdGEuc3RyZWFtc1szXS5jaGFubmVsLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIHJlcy5kYXRhLnN0cmVhbXNbNF0uY2hhbm5lbC5uYW1lXHJcbiAgICAgICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFkZCBlYWNoIG9mIHRoZSB0b3Agc3RyZWFtZXJzLlxyXG4gICAgICAgICAgICAgICAgdG9wU3RyZWFtZXJzLmZvckVhY2goZnVuY3Rpb24obmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGFkZFN0cmVhbWVyKG5hbWUpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocHJvbWlzZXMpO1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBBZGQgZWFjaCBvZiB0aGUgdHJhY2tlZCBzdHJlYW1lcnMuXHJcbiAgICAgICAgICAgIHRyYWNrZWQuc3BsaXQoJywnKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGFkZFN0cmVhbWVyKG5hbWUpKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXNvbHZlKHByb21pc2VzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qIFJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYSBzdHJlYW1lciBvbmNlIHRoZSBzdHJlYW1lcidzIGRhdGEgaGFzIGJlZW4gcmV0cmlldmVkIGFuZCBmb3JtYXR0ZWQuICovXHJcbiAgICBmdW5jdGlvbiBnZXRTdHJlYW1lcihuYW1lKSB7XHJcbiAgICAgIHJldHVybiBnZXRTdHJlYW1lckRhdGEoKVxyXG4gICAgICAgIC50aGVuKGZvcm1hdFN0cmVhbWVyRGF0YSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAkbG9nLndhcm4oJ0ZhaWxlZCB0byBnZXQgc3RyZWFtZXI6ICcgKyBuYW1lICsgJy4nLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgZnVuY3Rpb24gZ2V0U3RyZWFtZXJEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIHZhciBkYXRhID0ge307XHJcblxyXG4gICAgICAgICAgJGh0dHAuanNvbnAoJ2h0dHBzOi8vYXBpLnR3aXRjaC50di9rcmFrZW4vc3RyZWFtcy8nICsgbmFtZSArICc/Y2FsbGJhY2s9SlNPTl9DQUxMQkFDSycpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgIGRhdGEuYmFzaWMgPSByZXM7XHJcbiAgICAgICAgICAgICAgcmV0dXJuICRodHRwLmpzb25wKHJlcy5kYXRhLl9saW5rcy5jaGFubmVsICsgJz9jYWxsYmFjaz1KU09OX0NBTExCQUNLJyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgIGRhdGEuY2hhbm5lbCA9IHJlcztcclxuICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuanNvbnAocmVzLmRhdGEuX2xpbmtzLnZpZGVvcyArICc/Y2FsbGJhY2s9SlNPTl9DQUxMQkFDSycpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICBkYXRhLnZpZGVvcyA9IHJlcztcclxuICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBmb3JtYXRTdHJlYW1lckRhdGEoZGF0YSkge1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIHZhciBzdHJlYW1lciA9IHt9O1xyXG5cclxuICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBiYXNpY0RhdGEgPSBkYXRhLmJhc2ljO1xyXG4gICAgICAgICAgICB2YXIgY2hhbm5lbERhdGEgPSBkYXRhLmNoYW5uZWw7XHJcbiAgICAgICAgICAgIHZhciB2aWRlb3NEYXRhID0gZGF0YS52aWRlb3M7XHJcblxyXG4gICAgICAgICAgICBzdHJlYW1lci5uYW1lID0gbmFtZTsgIC8vIFVuaXF1ZSBpZGVudGlmaWVyLlxyXG4gICAgICAgICAgICBzdHJlYW1lci5vbmxpbmUgPSAoYmFzaWNEYXRhLmRhdGEuc3RyZWFtICE9PSBudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzdHJlYW1lci5vbmxpbmUpIHtcclxuICAgICAgICAgICAgICAvLyBTdHJlYW0gZGF0YS5cclxuICAgICAgICAgICAgICBzdHJlYW1lci5zdHJlYW0gPSB7fTtcclxuICAgICAgICAgICAgICBzdHJlYW1lci5zdHJlYW0uZ2FtZSA9IGJhc2ljRGF0YS5kYXRhLnN0cmVhbS5nYW1lO1xyXG4gICAgICAgICAgICAgIHN0cmVhbWVyLnN0cmVhbS52aWV3ZXJzID0gYmFzaWNEYXRhLmRhdGEuc3RyZWFtLnZpZXdlcnM7XHJcbiAgICAgICAgICAgICAgc3RyZWFtZXIuc3RyZWFtLnByZXZpZXcgPSBiYXNpY0RhdGEuZGF0YS5zdHJlYW0ucHJldmlldy5sYXJnZTsgIC8vIDY0MHgzNjAgLmpwZyBpbWFnZS5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ2hhbm5lbCBkYXRhLlxyXG4gICAgICAgICAgICBzdHJlYW1lci5kaXNwbGF5TmFtZSA9IGNoYW5uZWxEYXRhLmRhdGEuZGlzcGxheV9uYW1lO1xyXG4gICAgICAgICAgICBzdHJlYW1lci5sb2dvID0gY2hhbm5lbERhdGEuZGF0YS5sb2dvO1xyXG4gICAgICAgICAgICBzdHJlYW1lci5zdGF0dXMgPSBjaGFubmVsRGF0YS5kYXRhLnN0YXR1cztcclxuICAgICAgICAgICAgc3RyZWFtZXIudXJsID0gY2hhbm5lbERhdGEuZGF0YS51cmw7XHJcbiAgICAgICAgICAgIHN0cmVhbWVyLnZpZGVvQmFubmVyID0gY2hhbm5lbERhdGEuZGF0YS52aWRlb19iYW5uZXI7ICAvLyAuanBnIGltYWdlLCB1c3VhbGx5IDE5MjB4MTA4MCB0aG91Z2ggd2Ugb25seSBuZWVkIDY0MHgzNjAgdG8gbWF0Y2ggdGhlIHN0cmVhbS5wcmV2aWV3IGltYWdlLlxyXG5cclxuICAgICAgICAgICAgLy8gVmlkZW8gZGF0YS5cclxuICAgICAgICAgICAgc3RyZWFtZXIudmlkZW9zID0gW107XHJcblxyXG4gICAgICAgICAgICB2aWRlb3NEYXRhLmRhdGEudmlkZW9zLmZvckVhY2goZnVuY3Rpb24odmlkZW8pIHtcclxuICAgICAgICAgICAgICBzdHJlYW1lci52aWRlb3MucHVzaCh7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdmlkZW8udGl0bGUsXHJcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmlkZW8uZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICBkYXRlOiB2aWRlby5yZWNvcmRlZF9hdCxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB2aWRlby5sZW5ndGgsICAvLyBWaWRlbyBkdXJhdGlvbiBpbiBzZWNvbmRzLlxyXG4gICAgICAgICAgICAgICAgcHJldmlldzogdmlkZW8ucHJldmlldywgIC8vIDMyMHgyNDAgLmpwZyBpbWFnZS5cclxuICAgICAgICAgICAgICAgIHVybDogdmlkZW8udXJsXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJlc29sdmUoc3RyZWFtZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyogUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBzdHJlYW1lciBpcyB0cmFja2VkLiAqL1xyXG4gICAgZnVuY3Rpb24gdHJhY2tTdHJlYW1lcihzdHJlYW1lcikge1xyXG4gICAgICByZXR1cm4gY2FjaGUoKVxyXG4gICAgICAgIC50aGVuKHJlbWVtYmVyKVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICRsb2cud2FybignRmFpbGVkIHRvIHRyYWNrIGEgc3RyZWFtZXIuJywgZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNhY2hlKCkge1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIGlmICghc3RyZWFtZXIgfHwgIXN0cmVhbWVyLm5hbWUpIHtcclxuICAgICAgICAgICAgcmVqZWN0KCdBdHRlbXB0aW5nIHRvIGNhY2hlIGRhdGEgb24gYW4gdW5rbm93biBzdHJlYW1lci4nKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIENhY2hlIHRoZSBzdHJlYW1lcidzIGRhdGEuXHJcbiAgICAgICAgICAgIHZhciBpID0gc3RyZWFtZXJzLm1hcChmdW5jdGlvbihleGlzdGluZ1N0cmVhbWVyKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nU3RyZWFtZXIubmFtZTtcclxuICAgICAgICAgICAgfSkuaW5kZXhPZihzdHJlYW1lci5uYW1lKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIGV4aXN0aW5nIGNhY2hlZCBkYXRhLlxyXG4gICAgICAgICAgICAgIHN0cmVhbWVyc1tpXSA9IHN0cmVhbWVyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vIENhY2hlIHRoZSBkYXRhIGluIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmVhbWVycyBhcnJheS5cclxuICAgICAgICAgICAgICBzdHJlYW1lcnMudW5zaGlmdChzdHJlYW1lcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoJ1N0cmVhbWVyIGRhdGEgY2FjaGVkLicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiByZW1lbWJlcigpe1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIGlmICghc3RyZWFtZXIgfHwgIXN0cmVhbWVyLm5hbWUpIHtcclxuICAgICAgICAgICAgcmVqZWN0KCdBdHRlbXB0aW5nIHRvIHJlbWVtYmVyIGFuIHVua25vd24gc3RyZWFtZXIuJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBBZGQgdGhlIHN0cmVhbWVyJ3MgbmFtZSB0byB0aGUgY29va2llLlxyXG4gICAgICAgICAgICB2YXIgdHJhY2tlZCA9ICRjb29raWVzLmdldCgndHJhY2tlZFN0cmVhbWVycycpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0cmFja2VkKSB7XHJcbiAgICAgICAgICAgICAgLy8gVGhlIGNvb2tpZSBkb2Vzbid0IGV4aXN0IG9yIGlzIGVtcHR5LlxyXG4gICAgICAgICAgICAgICRjb29raWVzLnB1dCgndHJhY2tlZFN0cmVhbWVycycsIHN0cmVhbWVyLm5hbWUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vIE9ubHkgYWRkIHRoZSBuYW1lIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdC5cclxuICAgICAgICAgICAgICB2YXIgZXhpc3RzID0gdHJhY2tlZC5zcGxpdCgnLCcpLmluZGV4T2Yoc3RyZWFtZXIubmFtZSkgIT09IC0xO1xyXG4gICAgICAgICAgICAgIGlmICghZXhpc3RzKSB7XHJcbiAgICAgICAgICAgICAgICB0cmFja2VkID0gc3RyZWFtZXIubmFtZSArICcsJyArIHRyYWNrZWQ7XHJcbiAgICAgICAgICAgICAgICAkY29va2llcy5wdXQoJ3RyYWNrZWRTdHJlYW1lcnMnLCB0cmFja2VkKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoJ1N0cmVhbWVyIHJlbWVtYmVyZWQuJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHN0cmVhbWVyIGlzIHVudHJhY2tlZC4gKi9cclxuICAgIGZ1bmN0aW9uIHVudHJhY2tTdHJlYW1lcihuYW1lKSB7XHJcbiAgICAgIHJldHVybiB1bmNhY2hlKClcclxuICAgICAgICAudGhlbihmb3JnZXQpXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgJGxvZy53YXJuKCdGYWlsZWQgdG8gdW50cmFjayBhIHN0cmVhbWVyLicsIGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBmdW5jdGlvbiB1bmNhY2hlKCkge1xyXG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgIGlmICghbmFtZSkge1xyXG4gICAgICAgICAgICByZWplY3QoJ0F0dGVtcHRpbmcgdG8gdW5jYWNoZSBkYXRhIG9uIGFuIHVua25vd24gc3RyZWFtZXIuJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdW50cmFja1N0cmVhbWVyIGlzIHBhc3NlZCBhIHN0cmVhbWVyIG9iamVjdCBpbnN0ZWFkIG9mIG5hbWUuXHJcbiAgICAgICAgICAgIGlmIChuYW1lLm5hbWUpIHtcclxuICAgICAgICAgICAgICBuYW1lID0gbmFtZS5uYW1lO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBVbmNhY2hlIHRoZSBzdHJlYW1lcidzIGRhdGEuXHJcbiAgICAgICAgICAgIHN0cmVhbWVycyA9IHN0cmVhbWVycy5maWx0ZXIoZnVuY3Rpb24oc3RyZWFtZXIpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtZXIubmFtZSAhPT0gbmFtZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXNvbHZlKCdTdHJlYW1lciBkYXRhIHVuY2FjaGVkLicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBmb3JnZXQoKSB7XHJcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgaWYgKCFuYW1lKSB7XHJcbiAgICAgICAgICAgIHJlamVjdCgnQXR0ZW1wdGluZyB0byBmb3JnZXQgYW4gdW5rbm93biBzdHJlYW1lci4nKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgc3RyZWFtZXIncyBuYW1lIGZyb20gdGhlIGNvb2tpZS5cclxuICAgICAgICAgICAgdmFyIHRyYWNrZWQgPSAkY29va2llcy5nZXQoJ3RyYWNrZWRTdHJlYW1lcnMnKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0cmFja2VkKSB7XHJcbiAgICAgICAgICAgICAgdHJhY2tlZCA9IHRyYWNrZWQuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbihleGlzdGluZ05hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nTmFtZSAhPT0gbmFtZTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuam9pbignLCcpO1xyXG5cclxuICAgICAgICAgICAgICAkY29va2llcy5wdXQoJ3RyYWNrZWRTdHJlYW1lcnMnLCB0cmFja2VkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVzb2x2ZSgnU3RyZWFtZXIgZm9yZ290dGVuLicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59KSgpO1xyXG4iLCIvKiAgc3RyZWFtZXJzLmNvbnRyb2xsZXIuanNcclxuICogICAgSGFuZGxlcyBzdHJlYW1lcnMgbG9naWMgZm9yIHRoZSB2aWV3LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAuc3RyZWFtZXJzJylcclxuICAgIC5jb250cm9sbGVyKCdTdHJlYW1lcnNDb250cm9sbGVyJywgWydkYXRhc2VydmljZScsIFN0cmVhbWVyc0NvbnRyb2xsZXJdKTtcclxuXHJcbiAgZnVuY3Rpb24gU3RyZWFtZXJzQ29udHJvbGxlcihkYXRhc2VydmljZSkge1xyXG4gICAgdmFyIHZtID0gdGhpcztcclxuICAgIHZtLnN0cmVhbWVycyA9IFtdO1xyXG4gICAgdm0uZm91bmRJRHMgPSBbXTsgICAgICAgLy8gQXV0by1jb21wbGV0aW9uIHZhbHVlcy5cclxuICAgIHZtLnJlZnJlc2ggPSByZWZyZXNoO1xyXG4gICAgdm0uc29ydCA9IHNvcnQ7XHJcbiAgICB2bS5maWx0ZXIgPSBmaWx0ZXI7ICAgICAvLyBBbGlhcyBmb3IgdXBkYXRlU3RyZWFtZXJzKCkuIEJvdGggdXNlIHZtLmZpbHRlck9wdGlvbnMuXHJcbiAgICB2bS5maWx0ZXJPcHRpb25zID0ge307XHJcbiAgICB2bS5hZGQgPSBhZGQ7ICAgICAgICAgICAvLyBVc2VzIHZtLnRvQWRkLlxyXG4gICAgdm0udG9BZGQgPSAnJztcclxuICAgIHZtLnJlbW92ZSA9IHJlbW92ZTtcclxuICAgIHZtLmZpbmRNYXRjaGluZ0lEcyA9IGZpbmRNYXRjaGluZ0lEczsgICAvLyBVc2VzIHZtLnRvQWRkIHRvIGdldCBhdXRvLWNvbXBsZXRpb24gdmFsdWVzLlxyXG5cclxuICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gcmVmcmVzaCgpIHtcclxuICAgICAgZGF0YXNlcnZpY2UucmVmcmVzaFN0cmVhbWVycygpXHJcbiAgICAgICAgLnRoZW4odXBkYXRlU3RyZWFtZXJzKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzb3J0KHNvcnRPcHRpb24pIHtcclxuICAgICAgZGF0YXNlcnZpY2Uuc29ydFN0cmVhbWVycyhzb3J0T3B0aW9uKVxyXG4gICAgICAgIC50aGVuKHVwZGF0ZVN0cmVhbWVycyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZmlsdGVyKCkge1xyXG4gICAgICB1cGRhdGVTdHJlYW1lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhZGQoKSB7XHJcbiAgICAgIGRhdGFzZXJ2aWNlLmFkZFN0cmVhbWVyKHZtLnRvQWRkKVxyXG4gICAgICAgIC50aGVuKHVwZGF0ZVN0cmVhbWVycyk7XHJcblxyXG4gICAgICB2bS50b0FkZCA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJlbW92ZShuYW1lKSB7XHJcbiAgICAgIGRhdGFzZXJ2aWNlLnJlbW92ZVN0cmVhbWVyKG5hbWUpXHJcbiAgICAgICAgLnRoZW4odXBkYXRlU3RyZWFtZXJzKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBmaW5kTWF0Y2hpbmdJRHMoKSB7XHJcbiAgICAgIGRhdGFzZXJ2aWNlLmdldFN0cmVhbWVySURzKHZtLnRvQWRkKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKElEcykge1xyXG4gICAgICAgICAgdm0uZm91bmRJRHMgPSBJRHM7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAvLyBUT0RPOiBIYW5kbGUgdGhlIGZpbmQgSURzIGVycm9yLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICBkYXRhc2VydmljZS5yZWFkeSgpLnRoZW4odXBkYXRlU3RyZWFtZXJzKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVTdHJlYW1lcnMoKSB7XHJcbiAgICAgIGRhdGFzZXJ2aWNlLmdldFN0cmVhbWVycyh2bS5maWx0ZXJPcHRpb25zKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHN0cmVhbWVycykge1xyXG4gICAgICAgICAgdm0uc3RyZWFtZXJzID0gc3RyZWFtZXJzO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgLy8gVE9ETzogSGFuZGxlIHRoZSB1cGRhdGUgc3RyZWFtZXJzIGVycm9yLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSkoKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
